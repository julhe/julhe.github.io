<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name="hugo-theme" content="Axiom 0.7.2">



  <link rel="icon" type="image/png" sizes="32x32" href="https://julhe.github.io/">
  <link rel="icon" type="image/x-icon" href="https://julhe.github.io/">
  <link rel="apple-touch-icon" href="https://julhe.github.io/">
  <link rel="canonical" href="https://julhe.github.io/posts/building-an-android-app-with-rust-and-sdl2/">
<link rel="preload" as="style" href="https://julhe.github.io/bundle.css?v=1696604650" media="all">
<link rel="stylesheet" href="https://julhe.github.io/bundle.css?v=1696604650" media="all">
<style>.cdata pre{color:#edf2f7;background-color:#2d3748}.cdata :not(pre)>code{color:#805ad5;background-color:#f7fafc}.chroma .err{color:#fed7d7;background-color:#9b2c2c}.chroma .hl{background-color:#4a5568}.chroma .ln{color:#a0aec0}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#63b3ed}.chroma .kt{color:#b794f4}.chroma .na{color:#f6e05e}.chroma .nb{color:#f6ad55}.chroma .nc{color:#fc8181}.chroma .no{color:#68d391}.chroma .nd{color:#fc8181}.chroma .ne{color:#fc8181}.chroma .nf{color:#f6ad55}.chroma .nt{color:#fc8181}.chroma .l{color:#b794f4}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#68d391}.chroma .se{color:#a0aec0}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#68d391}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#b794f4}.chroma .o,.chroma .ow{color:#90cdf4}.chroma .p{color:#cbd5e0}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs{color:#a0aec0}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}
</style>

<link rel="preload" as="image" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Simple_DirectMedia_Layer%2C_Logo.svg/1920px-Simple_DirectMedia_Layer%2C_Logo.svg.png">

<title>TL;DR Building an Android app with Rust and SDL2 : julhe.github.io</title>

<meta property="og:title" content="TL;DR Building an Android app with Rust and SDL2">
<meta property="og:site_name" content="julhe.github.io">
<meta property="og:url" content="https://julhe.github.io/posts/building-an-android-app-with-rust-and-sdl2/">
<link rel="image_src" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Simple_DirectMedia_Layer%2C_Logo.svg/1920px-Simple_DirectMedia_Layer%2C_Logo.svg.png">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Simple_DirectMedia_Layer%2C_Logo.svg/1920px-Simple_DirectMedia_Layer%2C_Logo.svg.png">
<meta property="og:image:width" content="">
<meta property="og:image:height" content="">
<meta property="og:type" content="article">
<meta property="og:locale" content="en_us">
<meta property="og:description" content="A simple guide for bringing Rust &#43; SDL2 projects onto Android">
<meta name="description" content="A simple guide for bringing Rust &#43; SDL2 projects onto Android">
<meta property="og:updated_time" content="2020-06-11T09:27:09Z">
<meta property="fb:app_id" content="">
<meta name="author" content="Unknown">
<meta property="article:author" content="https://julhe.github.io/">
<meta property="article:published_time" content="2020-06-11T09:27:09Z">
<meta property="article:modified_time" content="2020-06-11T09:27:09Z">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "TL;DR Building an Android app with Rust and SDL2",
  "alternativeHeadline": "A simple guide for bringing Rust + SDL2 projects onto Android",
  "url": "https://julhe.github.io/posts/building-an-android-app-with-rust-and-sdl2/",
  "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Simple_DirectMedia_Layer%2C_Logo.svg/1920px-Simple_DirectMedia_Layer%2C_Logo.svg.png",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://julhe.github.io/posts/building-an-android-app-with-rust-and-sdl2/"
  },
  "description": "A simple guide for bringing Rust + SDL2 projects onto Android",
  "author": {
    "@type": "Person",
    "name": "Unknown"
  },
  "publisher": {
    "@type": "Organization",
    "name": "julhe.github.io",
    "logo": {
      "@type": "ImageObject",
      "url": "https://julhe.github.io/"
    }
  },
  "datePublished": "2020-06-11T09:27:09Z",
  "dateModified": "2020-06-11T09:27:09Z",
  "articleBody": "\u003cp\u003e\u003cem\u003eGuides on this topic are still pretty sparse, so I decided to write down the steps to make this work.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eAssuming you\u0026rsquo;ve already built a functional SDL2 Program in Rust that uses OpenGL, this small guide will help you bring it onto Android.\nYou will need:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA (more or less) functional SDL2 project\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.libsdl.org/download-2.0.php\"\u003eThe SDL2 Source\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cmake.org/download/\"\u003eCMake 3.8 to compile SDL 2\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.android.com/studio/\"\u003eAndroid Studio with NDK and CMake\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eBash, to run shell scripts (*.sh). The Bash that ships with the Git client is just fine.\u003c/li\u003e\n\u003cli\u003ethe \u003ccode\u003erustup\u003c/code\u003e executable\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAlso check that your Rust project:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIs built as a library.\u003c/li\u003e\n\u003cli\u003eHas an SDL entry point inside \u003ccode\u003elib.rs\u003c/code\u003e like\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-rust\" data-lang=\"rust\"\u003e\u003cspan style=\"color:#ff79c6\"\u003e#[no_mangle]\u003c/span\u003e\n\u003cspan style=\"color:#ff79c6\"\u003epub\u003c/span\u003e \u003cspan style=\"color:#ff79c6\"\u003eextern\u003c/span\u003e \u003cspan style=\"color:#ff79c6\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#50fa7b\"\u003eSDL_main\u003c/span\u003e(_argc: \u003cspan style=\"color:#50fa7b\"\u003elibc\u003c/span\u003e::c_int, _argv: \u003cspan style=\"color:#ff79c6\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ff79c6\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#ff79c6\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ff79c6\"\u003econst\u003c/span\u003e libc::c_char) -\u0026gt; \u003cspan style=\"color:#50fa7b\"\u003elibc\u003c/span\u003e::c_int {\n    my_actual_main_function();\n    \u003cspan style=\"color:#ff79c6\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#bd93f9\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003eso that the Android/Java SDL wrapper can call your library.\u003c/li\u003e\n\u003cli\u003eYou have something like this in your \u003ccode\u003ecargo.toml\u003c/code\u003e:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-toml\" data-lang=\"toml\"\u003e[lib]\nname = \u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;main\u0026#34;\u003c/span\u003e\ncrate-type = [\u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;cdylib\u0026#34;\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003eso that the library build is usable for C applications.\u003c/li\u003e\n\u003cli\u003eIs using an OpenGL version that is supported on Android, like OpenGL ES 2.0. And that the shaders are compatible with this version.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eI\u0026rsquo;ve tested this guide on Windows 10 x64, but it should work on other systems quite similarly.\u003c/p\u003e\n\u003ch1 id=\"prepare-android-toolchains-for-rust\"\u003ePrepare Android toolchains for Rust\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eInstall the build targets for Rust with\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003erustup target add aarch64-linux-android armv7-linux-androideabi i686-linux-android\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSetup the file \u003ccode\u003e~./cargo/config\u003c/code\u003e to point to the NDK toochains by adding:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-toml\" data-lang=\"toml\"\u003e[target.aarch64-linux-android]\nar = \u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;*PATH OF YOUR ANDROID NDK DIR*\\\\toolchains\\\\llvm\\\\prebuilt\\\\windows-x86_64\\\\bin\\\\aarch64-linux-android-ar\u0026#34;\u003c/span\u003e\nlinker =\u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;*PATH OF YOUR ANDROID NDK DIR*\\\\toolchains\\\\llvm\\\\prebuilt\\\\windows-x86_64\\\\bin\\\\aarch64-linux-android26-clang.cmd \u0026#34;\u003c/span\u003e\n\n[target.armv7-linux-androideabi]\nar = \u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;*PATH OF YOUR ANDROID NDK DIR*\\\\toolchains\\\\llvm\\\\prebuilt\\\\windows-x86_64\\\\bin\\\\arm-linux-androideabi-ar\u0026#34;\u003c/span\u003e\nlinker = \u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;*PATH OF YOUR ANDROID NDK DIR*\\\\toolchains\\\\llvm\\\\prebuilt\\\\windows-x86_64\\\\bin\\\\armv7a-linux-androideabi26-clang.cmd \u0026#34;\u003c/span\u003e\n\n[target.i686-linux-android]\nar = \u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;*PATH OF YOUR ANDROID NDK DIR*\\\\toolchains\\\\llvm\\\\prebuilt\\\\windows-x86_64\\\\bin\\\\i686-linux-android-ar\u0026#34;\u003c/span\u003e\nlinker = \u003cspan style=\"color:#f1fa8c\"\u003e\u0026#34;*PATH OF YOUR ANDROID NDK DIR*\\\\toolchains\\\\llvm\\\\prebuilt\\\\windows-x86_64\\\\bin\\\\i686-linux-android26-clang.cmd \u0026#34;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAnd add the full path to your Android NDK installation, typically \u003ccode\u003eC:\\Users\\*USERNAME*\\AppData\\Local\\Android\\sdk\\ndk\\*NDKVERSION*\\\u003c/code\u003e.\nYou can change the target SDK by changing the \u003ccode\u003eandroid26\u003c/code\u003e to any supported SDK version. Keep in mind that the cmd ending is Windows specific.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"prepare-sdl2-binaries\"\u003ePrepare SDL2 binaries\u003c/h1\u003e\n\u003cp\u003eNow we need to build the libraries for Rust to build against:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eDownload the \u003ca href=\"https://www.libsdl.org/download-2.0.php\"\u003eSDL2 Source Code\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eExtract the contents into a folder within your Rust project\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNavigate to the extraction folder and execute from a shell\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003endk-build \u003cspan style=\"color:#8be9fd;font-style:italic\"\u003eNDK_PROJECT_PATH\u003c/span\u003e\u003cspan style=\"color:#ff79c6\"\u003e=\u003c/span\u003e. \u003cspan style=\"color:#8be9fd;font-style:italic\"\u003eAPP_BUILD_SCRIPT\u003c/span\u003e\u003cspan style=\"color:#ff79c6\"\u003e=\u003c/span\u003e./Android.mk \u003cspan style=\"color:#8be9fd;font-style:italic\"\u003eAPP_PLATFORM\u003c/span\u003e\u003cspan style=\"color:#ff79c6\"\u003e=\u003c/span\u003eandroid-18\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"setup-the-android-project\"\u003eSetup the Android project\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003eCopy the \u0026ldquo;android-project\u0026rdquo; form the SDL2 source folder into your rust project (or where else you like). This will be our starting point.\u003c/li\u003e\n\u003cli\u003eCreate a symbolic link with the Windows CMD command:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-batch\" data-lang=\"batch\"\u003e\u003cspan style=\"color:#ff79c6\"\u003emklink\u003c/span\u003e /D *full path to your sdl2 source folder here*\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003efrom into the \u0026ldquo;android-project/app/jni\u0026rdquo; to the SDL2 source folder you\u0026rsquo;ve extracted. Or just copy the whole folder over (messy, not recommended).\u003c/li\u003e\n\u003cli\u003eEnter \u003ccode\u003eapp/gradle.build\u003c/code\u003e and comment out any \u003ccode\u003endkBuild\u003c/code\u003e blocks and remove the comment on \u003ccode\u003ecmake\u003c/code\u003e blocks\u003c/li\u003e\n\u003cli\u003eEnter \u003ccode\u003eapp/jni/CMakeLists.txt\u003c/code\u003e and remove the last line \u003ccode\u003eadd_subdirectory(src)\u003c/code\u003e, since we\u0026rsquo;re building the game libraries on our own.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"build-the-rust-binaries\"\u003eBuild the Rust binaries\u003c/h1\u003e\n\u003cp\u003eExecute this script in your Rust root folder every time you change your project:\u003c/p\u003e\n\u003cscript src=\"https://gist.github.com/julhe/f09f2504483721f9ca6cf16feecf7ccd.js\"\u003e\u003c/script\u003e\r\n\u003cp\u003eThen run the app from Android Studio and you\u0026rsquo;re done! On the first time, it should spend some time building SDL2, but any further rebuild will just rebuild the APK file.\u003c/p\u003e\n\u003cp\u003eFor further troubleshooting with the Android Project itself, \u003ca href=\"http://lazyfoo.net/tutorials/SDL/52_hello_mobile/android_windows/index.php\"\u003echeck this guide.\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"sources--futher-links\"\u003eSources / Futher links\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://wiki.libsdl.org/Android\"\u003ehttps://wiki.libsdl.org/Android\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://medium.com/visly/rust-on-android-19f34a2fb43\"\u003ehttps://medium.com/visly/rust-on-android-19f34a2fb43\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://lazyfoo.net/tutorials/SDL/52_hello_mobile/android_windows/index.php\"\u003ehttp://lazyfoo.net/tutorials/SDL/52_hello_mobile/android_windows/index.php\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://lliwynd.blogspot.com/2018/05/rust-for-android-games-using-sdl2.html\"\u003ehttps://lliwynd.blogspot.com/2018/05/rust-for-android-games-using-sdl2.html\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Rust-SDL2/rust-sdl2/blob/master/README.md\"\u003ehttps://github.com/Rust-SDL2/rust-sdl2/blob/master/README.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Rust-SDL2/rust-sdl2/issues/648\"\u003ehttps://github.com/Rust-SDL2/rust-sdl2/issues/648\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"
}
</script>

<link rel="preload" as="script" href="https://julhe.github.io/bundle.js?v=1696604650">


</head>
<body>

  <header id="nav" class="header">
  <div class="ax-l-i max-w-6xl">
    <div class="ax-logo">
      <a class="block" href="https://julhe.github.io/" title="julhe.github.io"><span class="font-semibold text-raven-900">julhe.github.io</span></a>
    </div>
    <div class="ax-user">
      <a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target="_blank" rel="noopener nofollow" href="https://www.google.com/search?q=site:https://julhe.github.io/" title="Search">
        <svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923l-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33 0 0 0 2.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg>

      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="https://julhe.github.io/about">
        About
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="https://julhe.github.io/posts">
        Posts
      </a>
      <a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href="https://julhe.github.io/showcase">
        Showcase
      </a>
    </div>
  </div>

  
</header>

  <main>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<div class="default-single">
  <div class="ax-title ax-l-o">
    <div class="ax-l-i max-w-680">
      <h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">TL;DR Building an Android app with Rust and SDL2</h1>

      <div class="ax-meta flex items-center mt-5">
        <div class="flex-grow min-w-0">
          <div class="flex items-center">
  <div class="flex-shrink-0">
    
  </div>
  <div class="flex-shrink-0 ml-2 leading-tight font-content-sans">
    <a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target="_blank" rel="noopener nofollow" title="Unknown" href="https://julhe.github.io/">Unknown</a>
    <time class="text-sm text-raven-500" datetime="2020-06-11T09:27:09Z">Jun 11, 2020 11:27AM</time>
  </div>
</div>

        </div>
        <div>
          <div class="flex items-center">
  <a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=TL%3bDR%20Building%20an%20Android%20app%20with%20Rust%20and%20SDL2%20by%20%40%23%20https%3a%2f%2fjulhe.github.io%2fposts%2fbuilding-an-android-app-with-rust-and-sdl2%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg>
</a>
  <a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2fjulhe.github.io%2fposts%2fbuilding-an-android-app-with-rust-and-sdl2%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234 0H1.765C.8.001 0 .79 0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766 0 3.284.13 3.726.2v4.32h-2.543c-2.006 0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21 0 30.234 0z"/></svg>
</a>
</div>

        </div>
      </div>
    </div>
  </div>
  <div class="ax-feature ax-l-o">
    <div class="ax-l-i max-w-5xl">

<figure>
<img
class="mb-2 mx-auto leading-none shadow-xl"
src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Simple_DirectMedia_Layer%2C_Logo.svg/1920px-Simple_DirectMedia_Layer%2C_Logo.svg.png"
alt="TL;DR Building an Android app with Rust and SDL2">
</figure>

    </div>
  </div><div class="ax-content ax-l-o">
    <div class="ax-l-i max-w-680">
      <article class="cdata">
<p><em>Guides on this topic are still pretty sparse, so I decided to write down the steps to make this work.</em></p>
<p>Assuming you&rsquo;ve already built a functional SDL2 Program in Rust that uses OpenGL, this small guide will help you bring it onto Android.
You will need:</p>
<ul>
<li>A (more or less) functional SDL2 project</li>
<li><a href="https://www.libsdl.org/download-2.0.php">The SDL2 Source</a></li>
<li><a href="https://cmake.org/download/">CMake 3.8 to compile SDL 2</a></li>
<li><a href="https://developer.android.com/studio/">Android Studio with NDK and CMake</a></li>
<li>Bash, to run shell scripts (*.sh). The Bash that ships with the Git client is just fine.</li>
<li>the <code>rustup</code> executable</li>
</ul>
<p>Also check that your Rust project:</p>
<ul>
<li>Is built as a library.</li>
<li>Has an SDL entry point inside <code>lib.rs</code> like
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#ff79c6">#[no_mangle]</span>
<span style="color:#ff79c6">pub</span> <span style="color:#ff79c6">extern</span> <span style="color:#ff79c6">fn</span> <span style="color:#50fa7b">SDL_main</span>(_argc: <span style="color:#50fa7b">libc</span>::c_int, _argv: <span style="color:#ff79c6">*</span><span style="color:#ff79c6">const</span> <span style="color:#ff79c6">*</span><span style="color:#ff79c6">const</span> libc::c_char) -&gt; <span style="color:#50fa7b">libc</span>::c_int {
    my_actual_main_function();
    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
}
</code></pre></div>so that the Android/Java SDL wrapper can call your library.</li>
<li>You have something like this in your <code>cargo.toml</code>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[lib]
name = <span style="color:#f1fa8c">&#34;main&#34;</span>
crate-type = [<span style="color:#f1fa8c">&#34;cdylib&#34;</span>]
</code></pre></div>so that the library build is usable for C applications.</li>
<li>Is using an OpenGL version that is supported on Android, like OpenGL ES 2.0. And that the shaders are compatible with this version.</li>
</ul>
<p>I&rsquo;ve tested this guide on Windows 10 x64, but it should work on other systems quite similarly.</p>
<h1 id="prepare-android-toolchains-for-rust">Prepare Android toolchains for Rust</h1>
<ol>
<li>
<p>Install the build targets for Rust with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">rustup target add aarch64-linux-android armv7-linux-androideabi i686-linux-android
</code></pre></div></li>
<li>
<p>Setup the file <code>~./cargo/config</code> to point to the NDK toochains by adding:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml">[target.aarch64-linux-android]
ar = <span style="color:#f1fa8c">&#34;*PATH OF YOUR ANDROID NDK DIR*\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\aarch64-linux-android-ar&#34;</span>
linker =<span style="color:#f1fa8c">&#34;*PATH OF YOUR ANDROID NDK DIR*\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\aarch64-linux-android26-clang.cmd &#34;</span>

[target.armv7-linux-androideabi]
ar = <span style="color:#f1fa8c">&#34;*PATH OF YOUR ANDROID NDK DIR*\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\arm-linux-androideabi-ar&#34;</span>
linker = <span style="color:#f1fa8c">&#34;*PATH OF YOUR ANDROID NDK DIR*\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\armv7a-linux-androideabi26-clang.cmd &#34;</span>

[target.i686-linux-android]
ar = <span style="color:#f1fa8c">&#34;*PATH OF YOUR ANDROID NDK DIR*\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\i686-linux-android-ar&#34;</span>
linker = <span style="color:#f1fa8c">&#34;*PATH OF YOUR ANDROID NDK DIR*\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin\\i686-linux-android26-clang.cmd &#34;</span>
</code></pre></div><p>And add the full path to your Android NDK installation, typically <code>C:\Users\*USERNAME*\AppData\Local\Android\sdk\ndk\*NDKVERSION*\</code>.
You can change the target SDK by changing the <code>android26</code> to any supported SDK version. Keep in mind that the cmd ending is Windows specific.</p>
</li>
</ol>
<h1 id="prepare-sdl2-binaries">Prepare SDL2 binaries</h1>
<p>Now we need to build the libraries for Rust to build against:</p>
<ol>
<li>
<p>Download the <a href="https://www.libsdl.org/download-2.0.php">SDL2 Source Code</a></p>
</li>
<li>
<p>Extract the contents into a folder within your Rust project</p>
</li>
<li>
<p>Navigate to the extraction folder and execute from a shell</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ndk-build <span style="color:#8be9fd;font-style:italic">NDK_PROJECT_PATH</span><span style="color:#ff79c6">=</span>. <span style="color:#8be9fd;font-style:italic">APP_BUILD_SCRIPT</span><span style="color:#ff79c6">=</span>./Android.mk <span style="color:#8be9fd;font-style:italic">APP_PLATFORM</span><span style="color:#ff79c6">=</span>android-18
</code></pre></div></li>
</ol>
<h1 id="setup-the-android-project">Setup the Android project</h1>
<ol>
<li>Copy the &ldquo;android-project&rdquo; form the SDL2 source folder into your rust project (or where else you like). This will be our starting point.</li>
<li>Create a symbolic link with the Windows CMD command:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-batch" data-lang="batch"><span style="color:#ff79c6">mklink</span> /D *full path to your sdl2 source folder here*
</code></pre></div>from into the &ldquo;android-project/app/jni&rdquo; to the SDL2 source folder you&rsquo;ve extracted. Or just copy the whole folder over (messy, not recommended).</li>
<li>Enter <code>app/gradle.build</code> and comment out any <code>ndkBuild</code> blocks and remove the comment on <code>cmake</code> blocks</li>
<li>Enter <code>app/jni/CMakeLists.txt</code> and remove the last line <code>add_subdirectory(src)</code>, since we&rsquo;re building the game libraries on our own.</li>
</ol>
<h1 id="build-the-rust-binaries">Build the Rust binaries</h1>
<p>Execute this script in your Rust root folder every time you change your project:</p>
<script src="https://gist.github.com/julhe/f09f2504483721f9ca6cf16feecf7ccd.js"></script>
<p>Then run the app from Android Studio and you&rsquo;re done! On the first time, it should spend some time building SDL2, but any further rebuild will just rebuild the APK file.</p>
<p>For further troubleshooting with the Android Project itself, <a href="http://lazyfoo.net/tutorials/SDL/52_hello_mobile/android_windows/index.php">check this guide.</a></p>
<h1 id="sources--futher-links">Sources / Futher links</h1>
<ul>
<li><a href="https://wiki.libsdl.org/Android">https://wiki.libsdl.org/Android</a></li>
<li><a href="https://medium.com/visly/rust-on-android-19f34a2fb43">https://medium.com/visly/rust-on-android-19f34a2fb43</a></li>
<li><a href="http://lazyfoo.net/tutorials/SDL/52_hello_mobile/android_windows/index.php">http://lazyfoo.net/tutorials/SDL/52_hello_mobile/android_windows/index.php</a></li>
<li><a href="https://lliwynd.blogspot.com/2018/05/rust-for-android-games-using-sdl2.html">https://lliwynd.blogspot.com/2018/05/rust-for-android-games-using-sdl2.html</a></li>
<li><a href="https://github.com/Rust-SDL2/rust-sdl2/blob/master/README.md">https://github.com/Rust-SDL2/rust-sdl2/blob/master/README.md</a></li>
<li><a href="https://github.com/Rust-SDL2/rust-sdl2/issues/648">https://github.com/Rust-SDL2/rust-sdl2/issues/648</a></li>
</ul>

      </article>
      

      

    </div>
  </div>
</div>
<hr>
<script src="https://utteranc.es/client.js"
        repo="julhe/julhe.github.io"
        issue-term="pathname"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

  </main>
  <footer class="footer">
  <div class="ax-l-i max-w-6xl">
    <nav class="flex items-center justify-center">
    </nav>
    <div class="footer-social flex items-center justify-center mt-4">
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Twitter" href="https://twitter.com/schneckerstein"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11 0 0 1-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56 0 0 0-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57 0 0 0 2.914 5.452 6.48 6.48 0 0 1-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42 0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18 0 0 1-8.134 2.798c-.538 0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072 0 18.672-10 18.672-18.668 0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="Github" href="https://github.com/julhe"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998 0C7.164 0 0 7.35 0 16.417 0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113 0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344 0 0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98 0 0 1 4.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406 0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836 0 15.998 0z"/></svg></a>
      <a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target="_blank" rel="noopener nofollow" title="LinkedIn" href="https://www.linkedin.com/in/julian-heinken-34463327/"><svg class="fill-current" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M29.692 0H2.308A2.31 2.31 0 0 0 0 2.308v27.384A2.31 2.31 0 0 0 2.308 32h27.384A2.31 2.31 0 0 0 32 29.692V2.308A2.31 2.31 0 0 0 29.692 0zM11.35 24.188H7.454V12.464h3.897v11.723zM9.402 10.863h-.025c-1.308 0-2.153-.9-2.153-2.025 0-1.15.872-2.026 2.205-2.026s2.153.875 2.18 2.026c0 1.125-.846 2.025-2.205 2.025zm16 13.324h-3.896v-6.272c0-1.576-.564-2.65-1.974-2.65-1.076 0-1.717.725-2 1.425-.103.25-.128.6-.128.95v6.547h-3.896V12.464h3.896v1.66c.518-.8 1.444-1.935 3.512-1.935 2.564 0 4.486 1.676 4.486 5.276v6.722z"/></svg></a>
    </div>

    <div class="footer-copyright text-sm text-center text-gray-500 mt-4">
      &#169; -2023 Julian Heinken
    </div>
    <div class="text-sm sm:text-xs text-center text-gray-500 mt-2">
      Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a>
    </div>
  </div>
</footer>

<script src="https://julhe.github.io/bundle.js?v=1696604650"></script>


</body>
</html>
